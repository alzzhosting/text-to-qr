<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Text → QR Generator — AlzzGenk</title>

  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary: #3b82f6;
      --primary-dark: #2563eb;
      --primary-light: #60a5fa;
      --bg: #f8fafc;
      --card-bg: #ffffff;
      --text: #1e293b;
      --text-light: #64748b;
      --text-lighter: #94a3b8;
      --border: #e2e8f0;
      --shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.1);
      --radius: 12px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      max-width: 1000px;
      width: 100%;
    }

    .card {
      background: var(--card-bg);
      border-radius: var(--radius);
      box-shadow: var(--shadow-lg);
      overflow: hidden;
      border: 1px solid var(--border);
    }

    /* Header */
    .header {
      padding: 32px 32px 24px;
      text-align: center;
      border-bottom: 1px solid var(--border);
    }

    .logo {
      width: 60px;
      height: 60px;
      border-radius: 16px;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 16px;
      color: white;
      font-weight: 700;
      font-size: 24px;
    }

    h1 {
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 8px;
    }

    .subtitle {
      color: var(--text-light);
      font-size: 1rem;
      font-weight: 400;
    }

    /* Main Content */
    .main-content {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0;
    }

    @media (max-width: 768px) {
      .main-content {
        grid-template-columns: 1fr;
      }
    }

    /* Form Section */
    .form-section {
      padding: 32px;
      border-right: 1px solid var(--border);
    }

    @media (max-width: 768px) {
      .form-section {
        border-right: none;
        border-bottom: 1px solid var(--border);
      }
    }

    .form-group {
      margin-bottom: 24px;
    }

    label {
      display: block;
      font-weight: 500;
      color: var(--text);
      margin-bottom: 8px;
      font-size: 0.9rem;
    }

    .input-wrapper {
      position: relative;
    }

    textarea {
      width: 100%;
      padding: 16px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: var(--bg);
      color: var(--text);
      font-family: 'Inter', sans-serif;
      font-size: 0.95rem;
      resize: vertical;
      min-height: 120px;
      transition: all 0.2s ease;
    }

    textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .char-count {
      position: absolute;
      bottom: 12px;
      right: 12px;
      font-size: 0.8rem;
      color: var(--text-lighter);
      background: var(--card-bg);
      padding: 2px 6px;
      border-radius: 4px;
    }

    .options-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    select {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: var(--bg);
      color: var(--text);
      font-family: 'Inter', sans-serif;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .actions {
      display: flex;
      gap: 12px;
      margin-top: 8px;
    }

    .btn {
      flex: 1;
      padding: 14px 20px;
      border: none;
      border-radius: 8px;
      font-family: 'Inter', sans-serif;
      font-weight: 600;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background: var(--primary-dark);
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: var(--bg);
      color: var(--text);
      border: 1px solid var(--border);
    }

    .btn-secondary:hover {
      background: #f1f5f9;
    }

    .note {
      margin-top: 20px;
      padding: 12px 16px;
      background: #fef3c7;
      border-radius: 8px;
      font-size: 0.85rem;
      color: #92400e;
      border-left: 4px solid #f59e0b;
    }

    /* Preview Section */
    .preview-section {
      padding: 32px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .preview-container {
      width: 100%;
      max-width: 300px;
      text-align: center;
    }

    .preview-title {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 16px;
    }

    .qr-container {
      background: white;
      border-radius: 12px;
      padding: 24px;
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      margin-bottom: 20px;
      min-height: 300px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .qr-placeholder {
      color: var(--text-lighter);
      font-size: 0.9rem;
    }

    .qr-image {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      transition: all 0.3s ease;
      opacity: 0;
      transform: scale(0.9);
    }

    .qr-image.loaded {
      opacity: 1;
      transform: scale(1);
    }

    .preview-actions {
      display: flex;
      gap: 12px;
      width: 100%;
    }

    .preview-actions .btn {
      flex: 1;
    }

    .btn-download {
      background: var(--primary);
      color: white;
    }

    .btn-download:hover {
      background: var(--primary-dark);
    }

    .btn-copy {
      background: var(--bg);
      color: var(--text);
      border: 1px solid var(--border);
    }

    .btn-copy:hover {
      background: #f1f5f9;
    }

    /* Footer */
    .footer {
      padding: 20px 32px;
      text-align: center;
      border-top: 1px solid var(--border);
      color: var(--text-light);
      font-size: 0.85rem;
    }

    /* Utility Classes */
    .hidden {
      display: none !important;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <div class="header">
        <div class="logo">QR</div>
        <h1>Text To QR</h1>
        <p class="subtitle">Convert text or URLs to QR codes instantly</p>
      </div>

      <div class="main-content">
        <!-- Form Section -->
        <div class="form-section">
          <div class="form-group">
            <label for="textInput">Text or URL</label>
            <div class="input-wrapper">
              <textarea 
                id="textInput" 
                placeholder="Enter your text or URL here..."
                maxlength="1000"
              ></textarea>
              <div class="char-count">
                <span id="charCount">0</span>/1000
              </div>
            </div>
          </div>

          

          <div class="actions">
            <button id="btnGenerate" class="btn btn-primary">
              <i class="fas fa-qrcode"></i>
              Generate QR
            </button>
            <button id="btnClear" class="btn btn-secondary">
              <i class="fas fa-eraser"></i>
              Clear
            </button>
          </div>

          <div class="note">
            <strong>Note:</strong> If you encounter CORS errors, try running from a local server instead of opening the file directly.
          </div>
        </div>

        <!-- Preview Section -->
        <div class="preview-section">
          <div class="preview-container">
            <div class="preview-title">QR Code Preview</div>
            
            <div class="qr-container">
              <div id="qrPlaceholder" class="qr-placeholder">
                <i class="fas fa-qrcode" style="font-size: 48px; margin-bottom: 12px; opacity: 0.3;"></i>
                <p>Your QR code will appear here</p>
              </div>
              <img id="qrImage" class="qr-image hidden" alt="QR Code">
            </div>

            <div class="preview-actions">
              <button id="btnDownload" class="btn btn-download hidden">
                <i class="fas fa-download"></i>
                Download
              </button>
              <button id="btnCopy" class="btn btn-copy hidden">
                <i class="fas fa-copy"></i>
                Copy Link
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="footer">
        Powered by api.xyro.site • Created by AlzzGenk
      </div>
    </div>
  </div>

  <!-- Font Awesome -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/js/all.min.js"></script>

  <script>
    const API_BASE = 'https://api.xyro.site/tools/text2qr?text=';

    // DOM Elements
    const elText = document.getElementById('textInput');
    const elGenerate = document.getElementById('btnGenerate');
    const elClear = document.getElementById('btnClear');
    const elQrImage = document.getElementById('qrImage');
    const elQrPlaceholder = document.getElementById('qrPlaceholder');
    const elDownload = document.getElementById('btnDownload');
    const elCopy = document.getElementById('btnCopy');
    const sizeSelect = document.getElementById('sizeSelect');
    const formatSelect = document.getElementById('formatSelect');
    const charCount = document.getElementById('charCount');

    let currentBlobUrl = null;
    let currentFilename = '';

    // Character count update
    elText.addEventListener('input', () => {
      charCount.textContent = elText.value.length;
    });

    // Toast notification
    function showToast(title, icon = 'success', timer = 1500) {
      Swal.fire({
        toast: true,
        position: 'top-end',
        showConfirmButton: false,
        timer,
        icon,
        title,
        background: '#1e293b',
        color: '#fff'
      });
    }

    // Set preview image
    function setPreviewImage(blobUrl, filename) {
      elQrPlaceholder.classList.add('hidden');
      elQrImage.src = blobUrl;
      elQrImage.classList.remove('loaded');
      elQrImage.classList.remove('hidden');
      
      currentFilename = filename;
      
      elQrImage.onload = () => {
        elQrImage.classList.add('loaded');
        elDownload.classList.remove('hidden');
        elCopy.classList.remove('hidden');
        showToast('QR code generated successfully', 'success', 1000);
      };
      
      elQrImage.onerror = () => {
        elQrImage.classList.add('hidden');
        elQrPlaceholder.classList.remove('hidden');
        Swal.fire({
          icon: 'error',
          title: 'Failed to load QR code',
          text: 'There was an issue displaying the QR code',
          background: '#1e293b',
          color: '#fff'
        });
      };
    }

    // Clear preview
    function clearPreview() {
      if (currentBlobUrl) {
        URL.revokeObjectURL(currentBlobUrl);
        currentBlobUrl = null;
      }
      currentFilename = '';
      elQrImage.classList.remove('loaded');
      elQrImage.classList.add('hidden');
      elQrPlaceholder.classList.remove('hidden');
      elDownload.classList.add('hidden');
      elCopy.classList.add('hidden');
      charCount.textContent = '0';
    }

    // Clear button
    elClear.addEventListener('click', () => {
      elText.value = '';
      clearPreview();
    });

    // Generate QR code
    elGenerate.addEventListener('click', async () => {
      const text = elText.value.trim();
      if (!text) {
        Swal.fire({
          icon: 'warning',
          title: 'Text is empty',
          text: 'Please enter some text or a URL first',
          background: '#1e293b',
          color: '#fff'
        });
        return;
      }

      const size = sizeSelect.value;
      const fmt = formatSelect.value;
      let apiUrl = API_BASE + encodeURIComponent(text);
      apiUrl += `&size=${encodeURIComponent(size)}`;
      apiUrl += `&format=${encodeURIComponent(fmt)}`;

      Swal.fire({
        title: 'Generating QR Code...',
        html: 'Please wait a moment',
        allowOutsideClick: false,
        didOpen: () => Swal.showLoading(),
        background: '#1e293b',
        color: '#fff'
      });

      try {
        const res = await fetch(apiUrl, { method: 'GET' });
        const contentType = res.headers.get('content-type') || '';

        if (contentType.includes('application/json')) {
          const j = await res.json();
          if (j && j.url) {
            const bres = await fetch(j.url);
            const blob = await bres.blob();
            const url = URL.createObjectURL(blob);
            if (currentBlobUrl) URL.revokeObjectURL(currentBlobUrl);
            currentBlobUrl = url;
            const filename = makeFilename(text, fmt);
            setPreviewImage(url, filename);
            Swal.close();
            return;
          } else {
            Swal.close();
            console.error('Unexpected JSON response', j);
            Swal.fire({
              icon: 'error',
              title: 'Unexpected response',
              text: 'Please check the console for details',
              background: '#1e293b',
              color: '#fff'
            });
            return;
          }
        }

        if (contentType.startsWith('image/')) {
          const blob = await res.blob();
          const url = URL.createObjectURL(blob);
          if (currentBlobUrl) URL.revokeObjectURL(currentBlobUrl);
          currentBlobUrl = url;
          const filename = makeFilename(text, fmt, contentType);
          setPreviewImage(url, filename);
          Swal.close();
          return;
        }

        const textResp = await res.text();
        Swal.close();
        console.error('Unknown response:', textResp);
        Swal.fire({
          icon: 'error',
          title: 'Failed to generate QR',
          html: 'Server responded with an unexpected format. See console.',
          background: '#1e293b',
          color: '#fff'
        });
      } catch (err) {
        Swal.close();
        console.error(err);
        Swal.fire({
          icon: 'error',
          title: 'Failed to access API',
          html: `${err.message}<br><br>If this is a CORS error, try running from a server (http/https) or use a proxy.`,
          background: '#1e293b',
          color: '#fff'
        });
      }
    });

    // Generate filename
    function makeFilename(text, fmt, contentType) {
      const safe = text.replace(/[^a-z0-9\-_\s]/gi, '').trim().replace(/\s+/g, '_').slice(0, 40) || 'qr';
      const ext = fmt === 'svg' ? 'svg' : (contentType && contentType.includes('svg') ? 'svg' : (fmt === 'png' ? 'png' : 'png'));
      const ts = new Date().toISOString().replace(/[:.]/g, '-');
      return `${safe}_${ts}.${ext}`;
    }

    // Download QR code
    elDownload.addEventListener('click', () => {
      if (!currentBlobUrl || !currentFilename) {
        showToast('No QR code to download', 'error');
        return;
      }

      try {
        // Create a temporary anchor element
        const link = document.createElement('a');
        link.href = currentBlobUrl;
        link.download = currentFilename;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        showToast('QR code downloaded successfully');
      } catch (error) {
        console.error('Download failed:', error);
        showToast('Download failed', 'error');
      }
    });

    // Copy download URL to clipboard
    elCopy.addEventListener('click', async () => {
      if (!currentBlobUrl) {
        showToast('No QR code to copy', 'error');
        return;
      }
      try {
        await navigator.clipboard.writeText(currentBlobUrl);
        showToast('QR code URL copied to clipboard');
      } catch (e) {
        showToast('Failed to copy URL', 'error');
      }
    });

    // Cleanup on unload
    window.addEventListener('unload', () => {
      if (currentBlobUrl) URL.revokeObjectURL(currentBlobUrl);
    });
  </script>
</body>
</html>