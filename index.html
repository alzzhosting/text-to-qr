<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login System - Auto Rotate Credentials</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- SweetAlert2 CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
  <style>
    :root {
      --primary-color: #4e73df;
      --secondary-color: #6c757d;
      --success-color: #1cc88a;
      --danger-color: #e74a3b;
      --warning-color: #f6c23e;
      --light-color: #f8f9fc;
      --dark-color: #5a5c69;
    }
    
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      margin: 0;
      padding: 0;
    }
    
    .login-container {
      background-color: white;
      border-radius: 15px;
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      width: 100%;
      max-width: 450px;
      transition: all 0.3s ease;
      position: relative;
    }
    
    .login-container:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
    }
    
    .login-header {
      background: var(--primary-color);
      color: white;
      padding: 25px;
      text-align: center;
      position: relative;
    }
    
    .login-header h2 {
      margin: 0;
      font-weight: 600;
    }
    
    .login-body {
      padding: 30px;
    }
    
    .form-control {
      border-radius: 8px;
      padding: 12px 15px;
      margin-bottom: 20px;
      border: 1px solid #e3e6f0;
      transition: all 0.3s;
    }
    
    .form-control:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 0.2rem rgba(78, 115, 223, 0.25);
    }
    
    .form-label {
      font-weight: 500;
      color: var(--dark-color);
      margin-bottom: 8px;
    }
    
    .btn-login {
      background-color: var(--primary-color);
      border: none;
      border-radius: 8px;
      color: white;
      padding: 12px;
      font-weight: 600;
      width: 100%;
      transition: all 0.3s;
      margin-bottom: 15px;
    }
    
    .btn-login:hover {
      background-color: #3a56c4;
      transform: translateY(-2px);
    }
    
    .btn-login:active {
      transform: translateY(0);
    }
    
    .btn-secondary {
      background-color: var(--secondary-color);
      border: none;
      border-radius: 8px;
      color: white;
      padding: 10px;
      font-weight: 500;
      width: 100%;
      transition: all 0.3s;
    }
    
    .btn-secondary:hover {
      background-color: #5a6268;
    }
    
    .login-footer {
      text-align: center;
      padding: 15px;
      color: var(--secondary-color);
      font-size: 14px;
      border-top: 1px solid #eaecf4;
    }
    
    .password-toggle {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      color: var(--secondary-color);
    }
    
    .password-container {
      position: relative;
    }
    
    .logo {
      width: 80px;
      height: 80px;
      background-color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 15px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    
    .logo i {
      font-size: 36px;
      color: var(--primary-color);
    }
    
    .credentials-info {
      position: absolute;
      top: 15px;
      right: 15px;
    }
    
    .btn-credentials {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      transition: all 0.3s;
    }
    
    .btn-credentials:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: scale(1.1);
    }
    
    .status-badge {
      position: absolute;
      top: 15px;
      left: 15px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 20px;
      padding: 5px 12px;
      font-size: 12px;
      color: white;
    }
    
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .fade-in {
      animation: fadeIn 0.5s ease-out;
    }
    
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, .3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }
    
    .credential-display {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
      border-left: 4px solid var(--primary-color);
    }
    
    .credential-item {
      display: flex;
      justify-content: between;
      margin-bottom: 8px;
    }
    
    .credential-label {
      font-weight: 600;
      color: var(--dark-color);
      min-width: 80px;
    }
    
    .credential-value {
      color: var(--primary-color);
      font-family: 'Courier New', monospace;
    }
  </style>
</head>

<body>
  <div class="login-container fade-in">
    <div class="credentials-info">
      <button class="btn-credentials" id="showCredentials" title="Lihat Kredensial">
        <i class="bi bi-info-circle"></i>
      </button>
    </div>
    
    <div class="status-badge" id="statusBadge">
      <i class="bi bi-cloud-check"></i> Online
    </div>
    
    <div class="login-header">
      <div class="logo">
        <i class="bi bi-shield-lock"></i>
      </div>
      <h2>Secure Login System</h2>
      <p class="mb-0">Auto-Rotate Credentials</p>
    </div>
    
    <div class="login-body">
      <div class="credential-display">
        <div class="credential-item">
          <span class="credential-label">Username:</span>
          <span class="credential-value" id="currentUsername">Loading...</span>
        </div>
        <div class="credential-item">
          <span class="credential-label">Password:</span>
          <span class="credential-value" id="currentPassword">Loading...</span>
        </div>
      </div>
      
      <form id="loginForm">
        <div class="mb-3">
          <label for="username" class="form-label">Username</label>
          <input type="text" class="form-control" id="username" placeholder="Masukkan username" required>
        </div>
        
        <div class="mb-4">
          <label for="password" class="form-label">Password</label>
          <div class="password-container">
            <input type="password" class="form-control" id="password" placeholder="Masukkan password" required>
            <span class="password-toggle" id="togglePassword">
              <i class="bi bi-eye"></i>
            </span>
          </div>
        </div>
        
        <button type="submit" class="btn btn-login" id="loginButton">
          <span id="loginText">Masuk</span>
          <span id="loginLoading" class="loading" style="display: none;"></span>
        </button>
        
        <button type="button" class="btn btn-secondary" id="refreshCredentials">
          <i class="bi bi-arrow-clockwise"></i> Refresh Credentials
        </button>
      </form>
    </div>
    
    <div class="login-footer">
      <p><i class="bi bi-info-circle"></i> Credentials akan berubah otomatis setelah digunakan</p>
      <p class="mb-0">&copy; 2024 Secure Login System</p>
    </div>
  </div>
  
  <!-- Bootstrap JS Bundle with Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- SweetAlert2 JS -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  
  <script>
    // Konfigurasi GitHub
        const GITHUB_TOKEN = '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'; // Ganti dengan token GitHub Anda
        const REPO_OWNER = 'alzzhosting'; // Ganti dengan username GitHub Anda
        const REPO_NAME = 'logindb'; // Ganti dengan nama repository Anda
        const CREDENTIALS_FILE = 'credentials.json';
        
        // URL untuk file JSON di GitHub
        const CREDENTIALS_URL = `https://raw.githubusercontent.com/${REPO_OWNER}/${REPO_NAME}/main/${CREDENTIALS_FILE}`;
        const API_URL = `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${CREDENTIALS_FILE}`;
        
        // Variabel untuk menyimpan kredensial
        let currentCredentials = { username: '', password: '' };
        let credentialsInUse = false;

        // Fungsi untuk generate random credentials
        function generateRandomCredentials() {
            const prefixes = ['user', 'admin', 'guest', 'member', 'client'];
            const randomPrefix = prefixes[Math.floor(Math.random() * prefixes.length)];
            const randomNumber = Math.floor(10000 + Math.random() * 90000);
            const username = `${randomPrefix}${randomNumber}`;
            
            const passwordLength = 6;
            const chars = '0123456789';
            let password = '';
            for (let i = 0; i < passwordLength; i++) {
                password += chars[Math.floor(Math.random() * chars.length)];
            }
            
            return { username, password };
        }

        // Fungsi untuk mengambil data kredensial dari GitHub
        async function fetchCredentials() {
            try {
                showLoadingState();
                
                const response = await fetch(CREDENTIALS_URL + '?t=' + Date.now());
                
                if (!response.ok) {
                    throw new Error('Gagal mengambil data kredensial');
                }
                
                const data = await response.json();
                currentCredentials = {
                    username: data.username || 'user20234',
                    password: data.password || '0090'
                };
                
                updateCredentialsDisplay();
                hideLoadingState();
                
                return currentCredentials;
            } catch (error) {
                console.error('Error fetching credentials:', error);
                hideLoadingState();
                
                Swal.fire({
                    title: 'Koneksi Gagal',
                    text: 'Tidak dapat terhubung ke server credentials.',
                    icon: 'error',
                    confirmButtonText: 'OK'
                });
                
                return null;
            }
        }

        // Fungsi untuk update credentials di GitHub
        async function updateCredentialsOnGitHub() {
            try {
                // First, get the current file to obtain its SHA
                const getResponse = await fetch(API_URL, {
                    headers: {
                        'Authorization': `token ${GITHUB_TOKEN}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                if (!getResponse.ok) {
                    throw new Error('Gagal mendapatkan info file');
                }

                const fileInfo = await getResponse.json();
                const sha = fileInfo.sha;

                // Generate new credentials
                const newCredentials = generateRandomCredentials();
                
                // Prepare content for update
                const content = JSON.stringify(newCredentials, null, 2);
                const encodedContent = btoa(unescape(encodeURIComponent(content)));

                // Update the file
                const updateResponse = await fetch(API_URL, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${GITHUB_TOKEN}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: `Auto-update credentials: ${new Date().toISOString()}`,
                        content: encodedContent,
                        sha: sha
                    })
                });

                if (!updateResponse.ok) {
                    throw new Error('Gagal mengupdate credentials');
                }

                return newCredentials;
            } catch (error) {
                console.error('Error updating credentials:', error);
                throw error;
            }
        }

        // Fungsi untuk update tampilan credentials
        function updateCredentialsDisplay() {
            document.getElementById('currentUsername').textContent = currentCredentials.username;
            document.getElementById('currentPassword').textContent = currentCredentials.password;
        }

        // Fungsi untuk show loading state
        function showLoadingState() {
            document.getElementById('loginText').style.display = 'none';
            document.getElementById('loginLoading').style.display = 'inline-block';
            document.getElementById('statusBadge').innerHTML = '<i class="bi bi-cloud-download"></i> Loading...';
        }

        // Fungsi untuk hide loading state
        function hideLoadingState() {
            document.getElementById('loginText').style.display = 'inline-block';
            document.getElementById('loginLoading').style.display = 'none';
            document.getElementById('statusBadge').innerHTML = '<i class="bi bi-cloud-check"></i> Online';
        }

        // Toggle password visibility
        document.getElementById('togglePassword').addEventListener('click', function() {
            const passwordInput = document.getElementById('password');
            const icon = this.querySelector('i');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                icon.classList.remove('bi-eye');
                icon.classList.add('bi-eye-slash');
            } else {
                passwordInput.type = 'password';
                icon.classList.remove('bi-eye-slash');
                icon.classList.add('bi-eye');
            }
        });

        // Tombol untuk refresh credentials
        document.getElementById('refreshCredentials').addEventListener('click', async function() {
            await fetchCredentials();
            Swal.fire({
                title: 'Credentials Diperbarui',
                text: 'Berhasil mengambil credentials terbaru dari server.',
                icon: 'success',
                confirmButtonText: 'OK',
                timer: 2000
            });
        });

        // Form submission handler
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (credentialsInUse) {
                Swal.fire({
                    title: 'Sedang Diproses',
                    text: 'Silakan tunggu, credentials sedang diupdate...',
                    icon: 'warning',
                    confirmButtonText: 'OK'
                });
                return;
            }
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Validasi input
            if (!username || !password) {
                Swal.fire({
                    title: 'Input Tidak Lengkap',
                    text: 'Harap isi username dan password.',
                    icon: 'warning',
                    confirmButtonText: 'OK'
                });
                return;
            }
            
            credentialsInUse = true;
            
            try {
                showLoadingState();
                
                if (username === currentCredentials.username && password === currentCredentials.password) {
                    // Login berhasil - update credentials
                    Swal.fire({
                        title: 'Login Berhasil!',
                        text: 'Credentials akan diupdate secara otomatis...',
                        icon: 'success',
                        showConfirmButton: false,
                        timer: 1500
                    }).then(() => {
                      window.location.href = 'dashboard'
                    })

                    // Update credentials di GitHub
                    const newCredentials = await updateCredentialsOnGitHub();
                    
                    // Update tampilan dengan credentials baru
                    currentCredentials = newCredentials;
                    updateCredentialsDisplay();
                    
                    // Clear form
                    document.getElementById('username').value = '';
                    document.getElementById('password').value = '';
                    
                    Swal.fire({
                        title: 'Credentials Diupdate!',
                        html: `
                            <p>Credentials baru telah dibuat:</p>
                            <div class="text-start">
                                <p><strong>Username:</strong> ${newCredentials.username}</p>
                                <p><strong>Password:</strong> ${newCredentials.password}</p>
                            </div>
                        `,
                        icon: 'info',
                        confirmButtonText: 'OK'
                    });
                } else {
                    // Login gagal
                    Swal.fire({
                        title: 'Login Gagal!',
                        html: `
                            <p>Username atau password salah.</p>
                            <div class="text-start mt-3">
                                <p><strong>Gunakan credentials:</strong></p>
                                <p>Username: <code>${currentCredentials.username}</code></p>
                                <p>Password: <code>${currentCredentials.password}</code></p>
                            </div>
                        `,
                        icon: 'error',
                        confirmButtonText: 'Coba Lagi'
                    });
                }
            } catch (error) {
                Swal.fire({
                    title: 'Error!',
                    text: 'Terjadi kesalahan saat memproses login.',
                    icon: 'error',
                    confirmButtonText: 'OK'
                });
            } finally {
                credentialsInUse = false;
                hideLoadingState();
            }
        });

        // Inisialisasi saat halaman dimuat
        document.addEventListener('DOMContentLoaded', async function() {
            document.querySelector('.login-container').classList.add('fade-in');
            
            // Ambil kredensial dari GitHub saat halaman dimuat
            await fetchCredentials();
        });
  </script>
</body>

</html>